---
const messages = [
{ text:"Soy Colapinto, en que te ayudo", from: "bot" },
];
---
<div class="chat-container">
<div id="chat-messages" class="chat-messages">
    {messages.map((msg, index) => (
    <div key={index} class={`message ${msg.from}`}>
        {msg.text}
    </div>
    ))}
</div>
<div class="chat-input">
    <input id="chat-input" type="text" placeholder="Escribe un mensaje..." />
    <button onClick="sendMessage()">Enviar</button>
</div>
</div>

<style>


.chat-container {
    background-color: #2e2e2e; /* Fondo gris oscuro */
    width: 100%;
    max-width: 400px;
    height: 500px;
    border-radius: 8px;
    padding: 16px;
    display: flex;
    flex-direction: column;
    color: #fff;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 16px;
    padding-right: 8px;
}

.message {
    margin: 8px 0;
    padding: 8px 12px;
    border-radius: 8px;
    max-width: 80%;
    word-wrap: break-word;
}
.user {
    background-color: #4a4a4a; /* Gris claro para el usuario */
    align-self: flex-end;
    color: #fff;
}

.bot {
    background-color: #1f1f1f; /* Gris muy oscuro para el bot */
    align-self: flex-start;
    color: #fff;
}

.chat-input {
    display: flex;
    gap: 8px;
}

.chat-input input {
    flex: 1;
    padding: 8px;
    border-radius: 4px;
    border: none;
    color: #fff;
    background-color: #3b3b3b; /* Gris medio para el campo de entrada */
}

.chat-input button {
    background-color: #007acc; /* Color de botón azul */
    color: #fff;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.chat-input input::placeholder {
    color: #999; /* Placeholder gris claro */
}
</style>

<script>
async function sendMessage() {
    const inputElement = document.getElementById("chat-input");
    const messageText = inputElement.value.trim();
    if (!messageText) return;

    // Agrega el mensaje del usuario al chat
    addMessage(messageText, "user");
    inputElement.value = "";

    // Enviar el mensaje al backend y obtener respuesta
    try {
        const response = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: messageText })
    });
    const data = await response.json();
    
      // Agregar la respuesta del bot al chat
    addMessage(data.reply, "bot");
    } catch (error) {
    console.error("Error en el chat:", error);
    addMessage("Lo siento, ocurrió un error. Inténtalo de nuevo más tarde.", "bot");
    }
}

function addMessage(text, from) {
    const chatMessages = document.getElementById("chat-messages");
    const messageElement = document.createElement("div");
    messageElement.classList.add("message", from);
    messageElement.textContent = text;
    chatMessages.appendChild(messageElement);
    chatMessages.scrollTop = chatMessages.scrollHeight; // Desplaza hacia abajo para ver el mensaje más reciente
}
</script>
